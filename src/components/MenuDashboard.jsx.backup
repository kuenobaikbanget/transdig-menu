import { useState, useRef } from 'react';
import '../styles/MenuDashboard.css';

const MenuDashboard = () => {
  const [cart, setCart] = useState([]);
  const [activeCategory, setActiveCategory] = useState('All');
  const [notes, setNotes] = useState({});
  const [searchQuery, setSearchQuery] = useState('');
  const [headerSearchQuery, setHeaderSearchQuery] = useState('');
  const [priceRange, setPriceRange] = useState([15100, 34600]);
  const [minPrice, setMinPrice] = useState(15100);
  const [maxPrice, setMaxPrice] = useState(34600);
  const [selectedCategories, setSelectedCategories] = useState([]);
  const [language, setLanguage] = useState('id'); // 'id' for Indonesian, 'en' for English
  const [sortBy, setSortBy] = useState('name-asc'); // default sorting
  const [showHeaderSearch, setShowHeaderSearch] = useState(false); // toggle header search
  
  // Add to Cart Modal States
  const [showAddToCartModal, setShowAddToCartModal] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [sugarLevel, setSugarLevel] = useState('100');
  const [selectedAdditionals, setSelectedAdditionals] = useState([]);
  const [itemNotes, setItemNotes] = useState('');

  // Refs for scrolling to menu items
  const menuItemRefs = useRef({});

  const categories = ['All', 'Coffee', 'Non-Coffee', 'Snacks'];
  const filterCategories = ['Kopsu', 'Classic', 'Kophit', 'Chocolate & Others', 'Matcha', 'Tea', 'Dopang'];

  // Additional options
  const additionalOptions = [
    { id: 'extra-shot', name: 'Extra Shot', price: 5000 },
    { id: 'whipped-cream', name: 'Whipped Cream', price: 3000 },
    { id: 'caramel-drizzle', name: 'Caramel Drizzle', price: 3000 },
    { id: 'chocolate-sauce', name: 'Chocolate Sauce', price: 3000 },
    { id: 'vanilla-syrup', name: 'Vanilla Syrup', price: 4000 },
    { id: 'hazelnut-syrup', name: 'Hazelnut Syrup', price: 4000 },
  ];

  const sugarLevels = [
    { value: '0', label: '0%' },
    { value: '25', label: '25%' },
    { value: '50', label: '50%' },
    { value: '75', label: '75%' },
    { value: '100', label: '100%' },
  ];

  const menuItems = [
    {
      id: 1,
      name: 'Espresso',
      category: 'Coffee',
      description: 'Bold and rich Italian espresso',
      price: 18000,
      image: 'â˜•'
    },
    {
      id: 2,
      name: 'Cappuccino',
      category: 'Coffee',
      description: 'Creamy espresso with steamed milk',
      price: 25000,
      image: 'â˜•'
    },
    {
      id: 3,
      name: 'Caffe Latte',
      category: 'Coffee',
      description: 'Smooth espresso with silky milk',
      price: 28000,
      image: 'â˜•'
    },
    {
      id: 4,
      name: 'Mocha',
      category: 'Coffee',
      description: 'Chocolate meets coffee perfection',
      price: 30000,
      image: 'â˜•'
    },
    {
      id: 5,
      name: 'Americano',
      category: 'Coffee',
      description: 'Espresso with hot water',
      price: 22000,
      image: 'â˜•'
    },
    {
      id: 6,
      name: 'Vietnamese Coffee',
      category: 'Coffee',
      description: 'Sweet condensed milk coffee',
      price: 26000,
      image: 'â˜•'
    },
    {
      id: 7,
      name: 'Matcha Latte',
      category: 'Non-Coffee',
      description: 'Premium Japanese green tea',
      price: 28000,
      image: 'ðŸµ'
    },
    {
      id: 8,
      name: 'Chocolate Milkshake',
      category: 'Non-Coffee',
      description: 'Rich and creamy chocolate blend',
      price: 30000,
      image: 'ðŸ¥¤'
    },
    {
      id: 9,
      name: 'Strawberry Smoothie',
      category: 'Non-Coffee',
      description: 'Fresh strawberry blend',
      price: 28000,
      image: 'ðŸ¥¤'
    },
    {
      id: 10,
      name: 'Lemon Tea',
      category: 'Non-Coffee',
      description: 'Refreshing citrus tea',
      price: 20000,
      image: 'ðŸ‹'
    },
    {
      id: 11,
      name: 'Croissant',
      category: 'Snacks',
      description: 'Buttery French pastry',
      price: 22000,
      image: 'ðŸ¥'
    },
    {
      id: 12,
      name: 'Chocolate Cake',
      category: 'Snacks',
      description: 'Decadent chocolate delight',
      price: 35000,
      image: 'ðŸ°'
    },
    {
      id: 13,
      name: 'Cheese Sandwich',
      category: 'Snacks',
      description: 'Grilled cheese perfection',
      price: 28000,
      image: 'ðŸ¥ª'
    },
    {
      id: 14,
      name: 'Banana Bread',
      category: 'Snacks',
      description: 'Homemade moist banana bread',
      price: 25000,
      image: 'ðŸŒ'
    },
    {
      id: 15,
      name: 'French Fries',
      category: 'Snacks',
      description: 'Crispy golden fries',
      price: 20000,
      image: 'ðŸŸ'
    }
  ];

  const filteredItems = activeCategory === 'All' 
    ? menuItems 
    : menuItems.filter(item => item.category === activeCategory);

  // Apply search filter (only from sidebar search)
  const searchFilteredItems = filteredItems.filter(item =>
    item.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
    item.description.toLowerCase().includes(searchQuery.toLowerCase())
  );

  // Apply price range filter
  const priceFilteredItems = searchFilteredItems.filter(item =>
    item.price >= priceRange[0] && item.price <= priceRange[1]
  );

  // Apply category filter (from sidebar)
  const finalFilteredItems = selectedCategories.length > 0
    ? priceFilteredItems.filter(item => 
        selectedCategories.some(cat => item.name.toLowerCase().includes(cat.toLowerCase()))
      )
    : priceFilteredItems;

  // Apply sorting
  const sortedItems = [...finalFilteredItems].sort((a, b) => {
    switch (sortBy) {
      case 'name-asc':
        return a.name.localeCompare(b.name);
      case 'name-desc':
        return b.name.localeCompare(a.name);
      case 'price-asc':
        return a.price - b.price;
      case 'price-desc':
        return b.price - a.price;
      default:
        return 0;
    }
  });

  const openAddToCartModal = (item) => {
    setSelectedItem(item);
    setSugarLevel('100');
    setSelectedAdditionals([]);
    setItemNotes('');
    setShowAddToCartModal(true);
  };

  const closeAddToCartModal = () => {
    setShowAddToCartModal(false);
    setSelectedItem(null);
    setSugarLevel('100');
    setSelectedAdditionals([]);
    setItemNotes('');
  };

  const toggleAdditional = (additionalId) => {
    setSelectedAdditionals(prev => {
      if (prev.includes(additionalId)) {
        return prev.filter(id => id !== additionalId);
      } else {
        return [...prev, additionalId];
      }
    });
  };

  const calculateTotalPrice = () => {
    if (!selectedItem) return 0;
    
    let total = selectedItem.price;
    
    selectedAdditionals.forEach(addId => {
      const additional = additionalOptions.find(opt => opt.id === addId);
      if (additional) {
        total += additional.price;
      }
    });
    
    return total;
  };

  const handleAddToCart = () => {
    if (!selectedItem) return;
    
    const newItem = {
      ...selectedItem,
      sugarLevel: sugarLevel,
      additionals: selectedAdditionals.map(addId => {
        const additional = additionalOptions.find(opt => opt.id === addId);
        return additional;
      }),
      specialNotes: itemNotes,
      totalPrice: calculateTotalPrice(),
      cartId: Date.now()
    };
    
    setCart([...cart, newItem]);
    closeAddToCartModal();
  };

  const handleNoteChange = (itemId, value) => {
    setNotes({ ...notes, [itemId]: value });
  };

  const getTotalItems = () => {
    return cart.length;
  };

  const isItemInCart = (itemId) => {
    return cart.some(cartItem => cartItem.id === itemId);
  };

  const getItemQuantityInCart = (itemId) => {
    return cart.filter(cartItem => cartItem.id === itemId).length;
  };

  const formatPrice = (price) => {
    return new Intl.NumberFormat('id-ID', {
      style: 'currency',
      currency: 'IDR',
      minimumFractionDigits: 0
    }).format(price);
  };

  const handleCategoryToggle = (category) => {
    setSelectedCategories(prev => {
      if (prev.includes(category)) {
        return prev.filter(c => c !== category);
      } else {
        return [...prev, category];
      }
    });
  };

  const handlePriceChange = (e) => {
    const value = parseInt(e.target.value);
    setPriceRange([0, value]);
  };

  const handleMinPriceChange = (e) => {
    const value = parseInt(e.target.value);
    // Pastikan min tidak melebihi max - 200 (gap minimum)
    if (value <= maxPrice - 200) {
      setMinPrice(value);
      setPriceRange([value, maxPrice]);
    }
  };

  const handleMaxPriceChange = (e) => {
    const value = parseInt(e.target.value);
    // Pastikan max tidak kurang dari min + 200 (gap minimum)
    if (value >= minPrice + 200) {
      setMaxPrice(value);
      setPriceRange([minPrice, value]);
    }
  };

  const handleMinPriceInputChange = (e) => {
    const value = e.target.value.replace(/[^\d]/g, ''); // Hanya angka
    const numValue = parseInt(value) || 0;
    // Update state langsung, validasi saat blur
    setMinPrice(numValue);
    // Update priceRange jika valid (dengan gap 200)
    if (numValue <= maxPrice - 200 && numValue <= 50000) {
      setPriceRange([numValue, maxPrice]);
    }
  };

  const handleMaxPriceInputChange = (e) => {
    const value = e.target.value.replace(/[^\d]/g, ''); // Hanya angka
    const numValue = parseInt(value) || 0;
    // Update state langsung, validasi saat blur
    setMaxPrice(numValue);
    // Update priceRange jika valid (dengan gap 200)
    if (numValue >= minPrice + 200 && numValue <= 50000) {
      setPriceRange([minPrice, numValue]);
    }
  };

  const handleMinPriceBlur = () => {
    // Validasi final saat blur (dengan gap 200)
    if (minPrice > maxPrice - 200) {
      const newMin = maxPrice - 200;
      setMinPrice(newMin > 0 ? newMin : 0);
      setPriceRange([newMin > 0 ? newMin : 0, maxPrice]);
    }
    if (minPrice > 50000) {
      setMinPrice(50000);
      setPriceRange([50000, maxPrice]);
    }
  };

  const handleMaxPriceBlur = () => {
    // Validasi final saat blur (dengan gap 200)
    if (maxPrice < minPrice + 200) {
      const newMax = minPrice + 200;
      setMaxPrice(newMax > 50000 ? 50000 : newMax);
      setPriceRange([minPrice, newMax > 50000 ? 50000 : newMax]);
    }
    if (maxPrice > 50000) {
      setMaxPrice(50000);
      setPriceRange([minPrice, 50000]);
    }
  };

  const formatRupiah = (value) => {
    return `Rp ${value.toLocaleString('id-ID')}`;
  };

  const toggleLanguage = () => {
    setLanguage(prev => prev === 'id' ? 'en' : 'id');
  };

  const toggleHeaderSearch = () => {
    setShowHeaderSearch(prev => !prev);
    if (showHeaderSearch) {
      setHeaderSearchQuery(''); // Clear search when closing
    }
  };

  const scrollToMenuItem = (itemId) => {
    // Close search modal
    setShowHeaderSearch(false);
    setHeaderSearchQuery('');
    
    // Wait for modal to close, then scroll
    setTimeout(() => {
      const element = menuItemRefs.current[itemId];
      if (element) {
        const headerOffset = 100; // Offset untuk header sticky
        const elementPosition = element.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });

        // Add highlight effect
        element.style.transition = 'all 0.3s ease';
        element.style.transform = 'scale(1.05)';
        element.style.boxShadow = '0 12px 40px rgba(107, 79, 55, 0.4)';
        
        setTimeout(() => {
          element.style.transform = 'scale(1)';
          element.style.boxShadow = '';
        }, 1000);
      }
    }, 300);
  };

  const handleResetFilters = () => {
    setSearchQuery('');
    setHeaderSearchQuery('');
    setMinPrice(0);
    setMaxPrice(50000);
    setPriceRange([0, 50000]);
    setSelectedCategories([]);
    setActiveCategory('All');
    setSortBy('name-asc');
  };

  // Check if any filter is active
  const hasActiveFilters = () => {
    return searchQuery !== '' || 
           minPrice !== 0 || 
           maxPrice !== 50000 || 
           activeCategory !== 'All' ||
           sortBy !== 'name-asc';
  };

  return (
    <div className="menu-dashboard">
      {/* Header */}
      <header className="menu-header">
        <div className="header-content">
          <div className="logo">
            <span className="logo-text">WISANGKOPI</span>
          </div>

          <div className="header-right">
            <div className="header-actions">
              {/* Search Icon Button */}
              <button 
                className="icon-btn search-toggle-btn"
                onClick={toggleHeaderSearch}
                title={language === 'id' ? 'Cari menu' : 'Search menu'}
              >
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="20" 
                  height="20" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  strokeWidth="2" 
                  strokeLinecap="round" 
                  strokeLinejoin="round"
                >
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
              </button>

              {/* Separator */}
              <div className="header-separator"></div>

              {/* Language Switcher */}
              <button 
                className="icon-btn language-toggle-btn"
                onClick={toggleLanguage}
                title={language === 'id' ? 'Switch to English' : 'Ganti ke Bahasa Indonesia'}
              >
                <span className="language-text-compact">{language === 'id' ? 'ID' : 'EN'}</span>
              </button>
            </div>

            {/* Cart Icon - Separated */}
            <button className="icon-btn cart-btn-separate">
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="20" 
                height="20" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              {getTotalItems() > 0 && (
                <span className="cart-badge">{getTotalItems()}</span>
              )}
            </button>
          </div>
        </div>
      </header>

      {/* Header Search Bar - Shows when toggled */}
      {showHeaderSearch && (
        <>
          {/* Overlay */}
          <div className="search-modal-overlay" onClick={toggleHeaderSearch}></div>
          
          {/* Search Modal */}
          <div className="search-modal">
            <div className="search-modal-header">
              <h2 className="search-modal-title">Cari</h2>
              <button 
                className="search-modal-close"
                onClick={toggleHeaderSearch}
                title="Tutup"
              >
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="24" 
                  height="24" 
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  strokeWidth="2" 
                  strokeLinecap="round" 
                  strokeLinejoin="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>

            {/* Search Input */}
            <div className="search-modal-input-wrapper">
              <input
                type="text"
                placeholder="Ketik untuk mencari..."
                value={headerSearchQuery}
                onChange={(e) => setHeaderSearchQuery(e.target.value)}
                className="search-modal-input"
                autoFocus
              />
              <svg 
                className="search-modal-input-icon"
                xmlns="http://www.w3.org/2000/svg" 
                width="20" 
                height="20" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>

            {/* Search Results */}
            <div className="search-modal-content">
              {headerSearchQuery === '' ? (
                <div className="search-modal-empty">
                  <p>Silakan masukkan kata kunci untuk mulai mencari.</p>
                </div>
              ) : (
                <div className="search-modal-results">
                  {sortedItems.filter(item =>
                    item.name.toLowerCase().includes(headerSearchQuery.toLowerCase()) ||
                    item.description.toLowerCase().includes(headerSearchQuery.toLowerCase())
                  ).length > 0 ? (
                    sortedItems.filter(item =>
                      item.name.toLowerCase().includes(headerSearchQuery.toLowerCase()) ||
                      item.description.toLowerCase().includes(headerSearchQuery.toLowerCase())
                    ).map(item => (
                      <div key={item.id} className="search-result-item" onClick={() => scrollToMenuItem(item.id)}>
                        <div className="search-result-icon">{item.image}</div>
                        <div className="search-result-info">
                          <h4 className="search-result-name">{item.name}</h4>
                          <p className="search-result-description">{item.description}</p>
                          <p className="search-result-price">{formatRupiah(item.price)}</p>
                        </div>
                      </div>
                    ))
                  ) : (
                    <div className="search-modal-empty">
                      <p>Tidak ada produk yang ditemukan.</p>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        </>
      )}

      {/* Main Content with Sidebar */}
      <div className="main-content">
        {/* Sidebar Filter */}
        <aside className="sidebar-filter">
          {/* Filter Header */}
          <div className="filter-header">
            <h3 className="filter-main-title">Filter Menu</h3>
          </div>

          {/* Search Bar */}
          <div className="filter-section">
            <h3 className="filter-title">Cari di menu kami</h3>
            <p className="filter-description">
              Cari menu, makanan, atau item spesial favoritmu di sini.
            </p>
            <div className="search-box">
              <svg 
                className="search-icon"
                xmlns="http://www.w3.org/2000/svg" 
                width="20" 
                height="20" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input
                type="text"
                placeholder="Cari menu..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="search-input"
              />
            </div>
          </div>

          {/* Price Filter */}
          <div className="filter-section">
            <h3 className="filter-title">Filter berdasarkan harga</h3>
            <p className="filter-description">
              Cari menu, makanan, atau item spesial favoritmu di sini.
            </p>
            <div className="price-slider">
              <div className="dual-range-slider">
                <input
                  type="range"
                  min="0"
                  max="50000"
                  step="100"
                  value={minPrice}
                  onChange={handleMinPriceChange}
                  className="slider slider-min"
                />
                <input
                  type="range"
                  min="0"
                  max="50000"
                  step="100"
                  value={maxPrice}
                  onChange={handleMaxPriceChange}
                  className="slider slider-max"
                />
                <div className="slider-track">
                  <div 
                    className="slider-range"
                    style={{
                      left: `${(minPrice / 50000) * 100}%`,
                      right: `${100 - (maxPrice / 50000) * 100}%`
                    }}
                  ></div>
                </div>
              </div>
              <div className="price-range-cards">
                <div className="price-card">
                  <div className="price-input-wrapper">
                    <span className="currency-symbol">Rp</span>
                    <input
                      type="text"
                      value={minPrice.toLocaleString('id-ID')}
                      onChange={handleMinPriceInputChange}
                      onBlur={handleMinPriceBlur}
                      className="price-input"
                      placeholder="0"
                    />
                  </div>
                </div>
                <div className="price-card">
                  <div className="price-input-wrapper">
                    <span className="currency-symbol">Rp</span>
                    <input
                      type="text"
                      value={maxPrice.toLocaleString('id-ID')}
                      onChange={handleMaxPriceInputChange}
                      onBlur={handleMaxPriceBlur}
                      className="price-input"
                      placeholder="50000"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </aside>

        {/* Main Menu Content */}
        <div className="menu-content">
          {/* Results Header */}
          <div className="results-header">
            <h2 className="results-title">Temukan Menu Wisangkopi</h2>
            <p className="results-subtitle">
              Pilihan kopi, minuman, dan makanan ringan yang dikurasi dengan cermat untuk menyesuaikan dengan selera dan suasana hati Anda.
            </p>
            <div className="results-info">
              <span className="results-count">
                1 to {sortedItems.length} of {menuItems.length} results
              </span>
              <div className="sort-dropdown">
                <label htmlFor="sort">Sort by:</label>
                <select 
                  id="sort" 
                  className="sort-select"
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                >
                  <option value="name-asc">Name (A-Z)</option>
                  <option value="name-desc">Name (Z-A)</option>
                  <option value="price-asc">Price (Low-High)</option>
                  <option value="price-desc">Price (High-Low)</option>
                </select>
                
                {/* Conditional Reset Button */}
                {hasActiveFilters() && (
                  <button 
                    className="reset-filter-btn"
                    onClick={handleResetFilters}
                    title="Reset semua filter"
                  >
                    <svg 
                      xmlns="http://www.w3.org/2000/svg" 
                      width="16" 
                      height="16" 
                      viewBox="0 0 24 24" 
                      fill="none" 
                      stroke="currentColor" 
                      strokeWidth="2" 
                      strokeLinecap="round" 
                      strokeLinejoin="round"
                    >
                      <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                      <path d="M21 3v5h-5"></path>
                      <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                      <path d="M3 21v-5h5"></path>
                    </svg>
                    <span>Reset</span>
                  </button>
                )}
              </div>
            </div>
          </div>

          {/* Category Navigation */}
          <div className="category-nav-inline">
            <div className="category-buttons">
              {categories.map((category) => (
                <button
                  key={category}
                  className={`category-btn ${activeCategory === category ? 'active' : ''}`}
                  onClick={() => setActiveCategory(category)}
                >
                  {category}
                </button>
              ))}
            </div>
          </div>

          {/* Menu Grid */}
          <div className="menu-grid">
            {sortedItems.map((item) => (
            <div 
              key={item.id} 
              className={`menu-card ${isItemInCart(item.id) ? 'in-cart' : ''}`}
              ref={(el) => (menuItemRefs.current[item.id] = el)}
            >
              {/* In Cart Badge */}
              {isItemInCart(item.id) && (
                <div className="in-cart-badge">
                  <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width="16" 
                    height="16" 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="3" 
                    strokeLinecap="round" 
                    strokeLinejoin="round"
                  >
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  <span>{getItemQuantityInCart(item.id)}x</span>
                </div>
              )}
              
              <div className="menu-card-image">
                <span className="image-placeholder">{item.image}</span>
              </div>
              <div className="menu-card-content">
                <h3 className="menu-item-name">{item.name}</h3>
                <p className="menu-item-description">{item.description}</p>
                <p className="menu-item-price">{formatPrice(item.price)}</p>

                <button 
                  className={`add-to-cart-btn ${isItemInCart(item.id) ? 'item-in-cart' : ''}`}
                  onClick={() => openAddToCartModal(item)}
                >
                  {isItemInCart(item.id) ? (
                    <>
                      <svg 
                        xmlns="http://www.w3.org/2000/svg" 
                        width="18" 
                        height="18" 
                        viewBox="0 0 24 24" 
                        fill="none" 
                        stroke="currentColor" 
                        strokeWidth="2" 
                        strokeLinecap="round" 
                        strokeLinejoin="round"
                      >
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                      <span>Added ({getItemQuantityInCart(item.id)}x) - Add More</span>
                    </>
                  ) : (
                    <>
                      <svg 
                        xmlns="http://www.w3.org/2000/svg" 
                        width="18" 
                        height="18" 
                        viewBox="0 0 24 24" 
                        fill="none" 
                        stroke="currentColor" 
                        strokeWidth="2" 
                        strokeLinecap="round" 
                        strokeLinejoin="round"
                      >
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                      <span>Add to Cart</span>
                    </>
                  )}
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>

    {/* Add to Cart Modal */}
    {showAddToCartModal && selectedItem && (
      <>
        {/* Overlay */}
        <div className="cart-modal-overlay" onClick={closeAddToCartModal}></div>
        
        {/* Modal */}
        <div className="cart-modal">
          <div className="cart-modal-header">
            <h2 className="cart-modal-title">Tambah ke Keranjang</h2>
            <button 
              className="cart-modal-close"
              onClick={closeAddToCartModal}
              title="Tutup"
            >
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>

          <div className="cart-modal-content">
            {/* Item Info */}
            <div className="cart-modal-item-info">
              <div className="cart-modal-item-icon">{selectedItem.image}</div>
              <div>
                <h3 className="cart-modal-item-name">{selectedItem.name}</h3>
                <p className="cart-modal-item-description">{selectedItem.description}</p>
                <p className="cart-modal-item-price">{formatPrice(selectedItem.price)}</p>
              </div>
            </div>

            {/* Sugar Level */}
            <div className="cart-modal-section">
              <h4 className="cart-modal-section-title">Sugar Level</h4>
              <div className="sugar-level-options">
                {sugarLevels.map(level => (
                  <button
                    key={level.value}
                    className={`sugar-level-btn ${sugarLevel === level.value ? 'active' : ''}`}
                    onClick={() => setSugarLevel(level.value)}
                  >
                    {level.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Additional Options */}
            <div className="cart-modal-section">
              <h4 className="cart-modal-section-title">Additional</h4>
              <div className="additional-options">
                {additionalOptions.map(option => (
                  <label key={option.id} className="additional-option">
                    <input
                      type="checkbox"
                      checked={selectedAdditionals.includes(option.id)}
                      onChange={() => toggleAdditional(option.id)}
                    />
                    <span className="additional-name">{option.name}</span>
                    <span className="additional-price">+{formatPrice(option.price)}</span>
                  </label>
                ))}
              </div>
            </div>

            {/* Notes */}
            <div className="cart-modal-section">
              <h4 className="cart-modal-section-title">Notes</h4>
              <textarea
                className="cart-modal-notes"
                placeholder="Tambahkan catatan khusus untuk pesanan Anda..."
                value={itemNotes}
                onChange={(e) => setItemNotes(e.target.value)}
                rows="3"
              />
            </div>
          </div>

          {/* Footer */}
          <div className="cart-modal-footer">
            <div className="cart-modal-total">
              <span>Total:</span>
              <span className="cart-modal-total-price">{formatPrice(calculateTotalPrice())}</span>
            </div>
            <button 
              className="cart-modal-add-btn"
              onClick={handleAddToCart}
            >
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="20" 
                height="20" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              >
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              <span>Tambah ke Keranjang</span>
            </button>
          </div>
        </div>
      </>
    )}
  </div>
);
};

export default MenuDashboard;
